# 全栈项目从零上线保姆级教程

这份文档将手把手教您如何将**腾昌精密机械官网**部署到互联网上，并实现**自动化更新**。

---

## 第一步：购买与准备云服务器

### 1. 选择云服务商
*   **国内推荐**：阿里云、腾讯云。速度快，稳定，但**必须备案**（需要10-20天）。
*   **免备案推荐**：阿里云（香港节点）、腾讯云（香港节点）。速度稍慢，但**买了就能用**。

### 2. 购买配置建议
由于我们的项目包含 Java 后端和 MySQL 数据库，建议最低配置如下：
*   **CPU**：2核
*   **内存**：4GB（2GB内存可能会导致构建时卡死）
*   **带宽**：3Mbps 以上（带宽太小加载图片会慢）
*   **操作系统**：**Ubuntu 22.04 LTS** (强烈推荐，本文档基于此系统编写)

### 3. 购买后的第一件事
1.  进入云控制台，找到**安全组**（或防火墙）设置。
2.  **开放端口**：
    *   `80` (HTTP，网站访问)
    *   `22` (SSH，远程连接)
    *   `8080` (后端API，可选，用于调试)
3.  **重置密码**：设置一个复杂的 `root` 密码。

### 4. 关于 MySQL 数据库
**注意：您不需要单独安装 MySQL！**
我为您配置的自动化脚本中已经包含了一个 MySQL 8.0 数据库容器。当您第一次部署项目时，它会：
1.  自动启动 MySQL 服务。
2.  自动执行初始化脚本，创建好所有的表（产品、分类、留言等）和测试数据。
3.  数据会自动保存在服务器的 `/opt/tc-project/mysql-data` 目录中，确保安全。

---

## 第二步：域名申请（可选但推荐）

1.  在云服务商处搜索购买域名（如 `tc-precision.com`）。
2.  进入**域名解析**控制台。
3.  添加一条 `A` 记录：
    *   **主机记录**：`@`
    *   **记录值**：填入您购买的服务器 **公网IP**。
4.  如果是国内服务器，请按照提示进行 ICP 备案。

---

## 第三步：服务器环境初始化

我们需要连接到服务器并安装 Docker。

### 1. 连接服务器
*   **Windows**：打开 PowerShell，输入 `ssh root@您的公网IP`，回车后输入密码。
*   **Mac/Linux**：打开终端，输入 `ssh root@您的公网IP`。

### 2. 安装 Docker（复制以下命令执行）
在服务器终端中，一次性复制并执行以下命令（Ubuntu 系统）：

```bash
# 更新软件源
apt-get update

# 安装 Docker
curl -fsSL https://get.docker.com -o get-docker.sh
sh get-docker.sh

# 安装 Docker Compose
apt-get install -y docker-compose-plugin

# 验证安装是否成功
docker compose version
```
*如果显示版本号，说明安装成功！*

---

## 第四步：配置 GitHub 自动化 (CI/CD)

这一步是实现“一键部署”的关键。

### 1. 准备 GitHub 仓库
1.  在 GitHub 上创建一个新仓库。
2.  将本地代码推送到该仓库。

### 2. 配置连接密钥 (Secrets)
为了让 GitHub 能自动把代码传到您的服务器，需要配置密钥。

1.  打开 GitHub 仓库页面，点击顶部 **Settings**。
2.  在左侧栏找到 **Secrets and variables** -> **Actions**。
3.  点击 **New repository secret**，依次添加以下三个变量：

| Name | Secret (值) | 说明 |
| :--- | :--- | :--- |
| `HOST` | `1.2.3.4` | 您的服务器公网 IP |
| `USERNAME` | `root` | 服务器用户名（通常是 root） |
| `PASSWORD` | `您的密码` | 服务器 root 密码 |

*(注：如果您懂 SSH Key，也可以用 `SSH_KEY` 代替 `PASSWORD`，更安全)*

---

## 第五步：第一次部署

1.  **提交代码**：确保您已经完成了本地开发，并执行了 `git push`。
2.  **观察进度**：
    *   打开 GitHub 仓库的 **Actions** 标签页。
    *   您会看到一个名为 `Deploy to Server` 的任务正在运行。
    *   等到它显示绿色对勾 ✅，说明部署成功！

3.  **访问网站**：
    *   在浏览器输入 `http://您的公网IP` 或 `http://您的域名`。
    *   您应该能看到网站已经上线了！

---

## 常见问题与维护

### 1. 图片存在哪里？
在服务器上，我为您自动创建了目录 `/opt/tc-project/uploads`。所有的上传图片都会保存在这里。即使您重装了 Docker，图片也不会丢失。

### 2. 数据库数据在哪里？
数据库文件保存在 `/opt/tc-project/mysql-data`。

### 3. 如何查看日志？
登录服务器，在 `/opt/tc-project` 目录下执行：
```bash
# 查看所有日志
docker compose logs -f

# 只看后端的报错
docker compose logs -f backend
```

### 4. 我修改了代码，如何更新？
不需要做任何服务器操作！
只要在本地修改代码 -> `git commit` -> `git push`。
GitHub 会自动帮您重新打包并重启服务器。等待约 3-5 分钟即可生效。
